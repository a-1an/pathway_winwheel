name: Build WinWheel

on: [push, pull_request]

jobs:
  build_wheels:
    name: Build wheels on ${{ matrix.os }}
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [windows-latest]

    steps:
      - name: Checkout code
        uses: actions/checkout@v4  # Checkout the repository code

      - name: Set up Python
        uses: actions/setup-python@v5  # Set up Python environment

      - name: Install Rust
        run: rustup toolchain install stable  # Install Rust toolchain

      - name: Add i686-pc-windows-msvc target
        run: rustup target add i686-pc-windows-msvc  # Add necessary Rust target

      - name: Install cibuildwheel
        run: python -m pip install cibuildwheel==2.19.1  # Install cibuildwheel

      - name: Build wheels
        run: python -m cibuildwheel --output-dir wheelhouse  # Build wheels
        env:
          CIBW_BUILD: "cp310-win32"  # Target Python 3.10 on 32-bit Windows
          CIBW_SKIP: "cp27-*"  # Skip Python 2.7 builds
          CIBW_PROJECT_REQUIRES_PYTHON: "./python/pathway"  # Set package directory

      - name: Upload wheels
        uses: actions/upload-artifact@v4  # Upload built wheels as artifacts
        with:
          name: cibw-wheels-${{ matrix.os }}-${{ strategy.job-index }}
          path: ./wheelhouse/*.whl
